name: "Schema Generation"
description: "Tests for the gen-schema command"

scenarios:
  - id: exits_zero
    name: "Exits successfully"
    run:
      command: go run ./cmd/gen-schema
      timeout: 30s
    assertions:
      - command: assert_equals 0 ${RUN_OUTPUT}/exit_code

  - id: has_schema_root
    name: "Has JSON Schema root properties"
    run:
      command: go run ./cmd/gen-schema
      timeout: 30s
    assertions:
      - command: assert_contains "$defs" ${RUN_OUTPUT}/stdout
      - command: assert_contains "oneOf" ${RUN_OUTPUT}/stdout

  - id: includes_all_event_types
    name: "Includes all expected event types"
    run:
      command: go run ./cmd/gen-schema
      timeout: 30s
    assertions:
      - command: assert_contains RunStartEvent ${RUN_OUTPUT}/stdout
      - command: assert_contains RunEndEvent ${RUN_OUTPUT}/stdout
      - command: assert_contains ContextEnterEvent ${RUN_OUTPUT}/stdout
      - command: assert_contains ContextExitEvent ${RUN_OUTPUT}/stdout
      - command: assert_contains ScenarioEnterEvent ${RUN_OUTPUT}/stdout
      - command: assert_contains ScenarioExitEvent ${RUN_OUTPUT}/stdout
      - command: assert_contains ScenarioRunStartEvent ${RUN_OUTPUT}/stdout
      - command: assert_contains ScenarioRunEndEvent ${RUN_OUTPUT}/stdout
      - command: assert_contains AssertionStartEvent ${RUN_OUTPUT}/stdout
      - command: assert_contains AssertionEndEvent ${RUN_OUTPUT}/stdout
      - command: assert_contains OutputEvent ${RUN_OUTPUT}/stdout
      - command: assert_contains HookStartEvent ${RUN_OUTPUT}/stdout
      - command: assert_contains HookEndEvent ${RUN_OUTPUT}/stdout
      - command: assert_contains TimeoutEvent ${RUN_OUTPUT}/stdout

  - id: events_have_required_fields
    name: "Events specify required fields"
    run:
      command: go run ./cmd/gen-schema
      timeout: 30s
    assertions:
      - command: assert_contains required ${RUN_OUTPUT}/stdout
